function checkLogin(e){function t(){$("#content").show(),$("#login").hide(),$("#search-query").focus(),$("#spreadsheet-confirm-btn").click(()=>{$("#spreadsheet-confirm").hide(),$("#spreadsheet-content").html('\n                <a href="https://docs.google.com/spreadsheets/d/15Z9AgrqGNprz2K8c032ZhJ7Wm5bTV-2fJfublK7L1L8/edit?usp=drive_web" target="_blank">Edit Spreadsheet</a>\n                <iframe src="https://docs.google.com/spreadsheets/d/15Z9AgrqGNprz2K8c032ZhJ7Wm5bTV-2fJfublK7L1L8/pubhtml?widget=true&amp;headers=false"></iframe>\n            '),$("#spreadsheet").show()})}$("#loading-login").hide();for(let l of e)if(hash(l.name,l.email)==localStorage.getItem("userHash"))return void t();$("#login").show(),$("#login-btn").click(()=>{let l=$("#name").val(),o=$("#email").val();for(let a of e)if(l.toLowerCase().trim()==a.name.toLowerCase().trim()&&o.toLowerCase().trim()==a.email.toLowerCase().trim())return localStorage.setItem("userHash",hash(l.toLowerCase().trim(),o.toLowerCase().toLowerCase().trim())),void t();alert("Incorrect name or email!")})}function hash(e,t){let l=e+t,o=0;for(let e=0;e<l.length;e++)o+=l.charCodeAt(e);let a=987654321+o,s=987654321-o,r=((s=36969*(65535&s)+(s>>16)&4294967295)<<16)+(a=18e3*(65535&a)+(a>>16)&4294967295);return(r/=4294967296)+.5}function normalizeName(e){if(e.length<1)return e;if(e.search(", ")>0){let t=e.split(", ");return(t[1]+" "+t[0]).toLowerCase()}return console.error(`Unable to split name ${e} into first and last name`),e}function updateURLQuery(e){if(history.pushState){let t=window.location.protocol+"//"+window.location.host+window.location.pathname+e;window.history.pushState({path:t},"",t)}else window.location.href=window.location.protocol+"//"+window.location.host+window.location.pathname+e}function showSearchResults(e){if(""===e)return;let t=[];(e=e.toLowerCase()).search(" ")>0?t=e.split(" "):(t[0]=e,t[1]=null,void 0!==t[2]&&(t=t.splice(0,2))),""===t[1]&&(t[1]=null),console.log(window.globalData),console.log(t);let l=[];for(let e of window.globalData){let t=e["Scout's Full Name (last name first):"].trim(),o=[];if(2===(t.match(/\s/g)||[]).length){let e=t.split(" ");o[0]=e[2],o[1]=e[0].slice(0,-1)}else if(t.search(", ")>0){let e=(o=t.split(", "))[0];o[0]=o[1],o[1]=e}else if(1===(t.match(/\s/g)||[]).length)o=t.split(" ");else if(t.search(",")>0){let e=(o=t.split(","))[0];o[0]=o[1],o[1]=e}else o="ERROR",console.error("Unable to split given full name into first and last name");o[0]=o[0].toLowerCase(),o[1]=o[1].toLowerCase(),l.push(o)}let o=[],a=[];for(let e=0;e<l.length;e++)if(null===t[1])if(l[e][0]===t[0]||l[e][1]===t[0])a.push({id:e,score:0});else{let o=compare(t[0],l[e][0])<compare(t[0],l[e][1])?compare(t[0],l[e][0]):compare(t[0],l[e][1]);o<t[0].length/2&&a.push({id:e,score:o+1})}else{if(l[e][0]===t[0]&&l[e][1]===t[1]){a.push({id:e,score:0});break}{let o=compare(t[0],l[e][0])+compare(t[1],l[e][1]);o<(t[0].length+t[1].length)/2&&a.push({id:e,score:o+1})}}if(a.sort((e,t)=>parseFloat(e.score)-parseFloat(t.score)),a[0]){let e=a[0].score;for(let t=0;t<a.length;t++)if(a[t].score===e)o.push(a[t].id);else{if(a[t].score!==e)break;t<3&&o.push(a[t].id)}}if($("#detail").hide(),$("#results").hide(),0===o.length)$("#no-result").html("Your search - <b>"+e+"</b> - did not match any names."),$("#no-result").show();else{$("#no-result").hide(),$("#results > tbody").html("");for(let e of o){let t=window.globalData[e]["Scout's Full Name (last name first):"];$("#results > tbody").append(`\n                <tr>\n                    <td><a onclick="showfullinfo(${e})">${t}</a></td>\n                    <td>${window.globalData[e]["Scout's Cell Phone"]}</td>\n                </tr>\n            `)}$("#results").show()}}function showfullinfo(e,t){!1!==t&&updateURLQuery("?type=profile&id="+encodeURIComponent(e)),$("#results").hide(),$("#detail").show().html("").append(`\n        <br>\n        Name:                               ${window.globalData[e]["Scout's Full Name (last name first):"]}<br>\n        Email: <a href="mailto:             ${window.globalData[e]["Scout's E-mail:"]}">     ${window.globalData[e]["Scout's E-mail:"]}</a><br>\n        Cell Phone: <a href="tel:           ${window.globalData[e]["Scout's Cell Phone"]}">  ${window.globalData[e]["Scout's Cell Phone"]}</a><br>\n        Home Phone: <a href="tel:           ${window.globalData[e]["Scout's Home Phone"]}">  ${window.globalData[e]["Scout's Home Phone"]}</a><br>\n        Patrol:                             ${window.globalData[e].patrol}<br><br>\n        Father's Cell Phone: <a href="tel: ${window.globalData[e]["Father's Cell Phone"]}"> ${window.globalData[e]["Father's Cell Phone"]}</a><br>\n        Father's E-mail: <a href="mailto:  ${window.globalData[e]["Father's E-mail"]}">     ${window.globalData[e]["Father's E-mail"]}</a><br>\n        Mother's Cell Phone: <a href="tel: ${window.globalData[e]["Mother's Cell Phone"]}"> ${window.globalData[e]["Mother's Cell Phone"]}</a><br>\n        Mother's E-mail: <a href="mailto:  ${window.globalData[e]["Mother's E-mail"]}">     ${window.globalData[e]["Mother's E-mail"]}</a><br>\n    `)}Tabletop.init({key:"15Z9AgrqGNprz2K8c032ZhJ7Wm5bTV-2fJfublK7L1L8",callback:function(e){window.globalData=[];let t=[];for(let l of Object.keys(e))for(let o of e[l].elements){o.patrol=l,o["Scout's Full Name (last name first):"]=normalizeName(o["Scout's Full Name (last name first):"].trim()),window.globalData.push(o);let e=o["Scout's E-mail:"].toLowerCase(),a=normalizeName(o["父親全名 Father's Full Name (last name first)"]),s=o["Father's E-mail"].toLowerCase(),r=normalizeName(o["母親全名 Mother's Full Name (last name first)"]),n=o["Mother's E-mail"].toLowerCase();e.length>2&&(t.push({name:o["Scout's Full Name (last name first):"],email:e}),t.push({name:o["Scout's Full Name (last name first):"].split(" ").reverse().join(" "),email:e})),a.length>2&&s.length>2&&t.push({name:a,email:s}),t.push({name:a.split(" ").reverse().join(" "),email:e}),r.length>2&&n.length>2&&t.push({name:r,email:n}),t.push({name:r.split(" ").reverse().join(" "),email:e})}window.globalData.sort((e,t)=>e["Scout's Full Name (last name first):"]<t["Scout's Full Name (last name first):"]?-1:e["Scout's Full Name (last name first):"]>t["Scout's Full Name (last name first):"]?1:0),console.log(t),checkLogin(t)},simpleSheet:!1}),window.globalData=[],$(document).ready(()=>{$("#password").focus()}),$("#search-query").keypress(e=>{13===e.keyCode&&$("#search-btn").click()}),$("#search-btn").click(()=>{window.userquery=$("#search-query").val(),updateURLQuery("?type=list&query="+encodeURIComponent(window.userquery)),showSearchResults(window.userquery)}),"list"===getQuery("type")&&null!==getQuery("query")&&""!==getQuery("query")?($(".loading").show(),setTimeout(()=>{$("#search-query").val(getQuery("query")),showSearchResults(getQuery("query")),$(".loading").hide()},1500)):"profile"===getQuery("type")&&null!==getQuery("id")&&""!==getQuery("id")&&($(".loading").show(),setTimeout(()=>{showfullinfo(parseInt(getQuery("id"),10),!1),$(".loading").hide()},1500)),$("#email").keypress(e=>{e&&13==e.keyCode&&$("#login-btn").click()});