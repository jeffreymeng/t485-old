!function(){var e={},n=function(n){for(var t=e[n],r=t.deps,i=t.defn,a=r.length,c=new Array(a),d=0;d<a;++d)c[d]=o(r[d]);var l=i.apply(null,c);if(void 0===l)throw"module ["+n+"] returned undefined";t.instance=l},t=function(n,t,o){if("string"!=typeof n)throw"module id must be a string";if(void 0===t)throw"no dependencies for "+n;if(void 0===o)throw"no definition function for "+n;e[n]={deps:t,defn:o,instance:void 0}},o=function(t){var o=e[t];if(void 0===o)throw"module ["+t+"] was undefined";return void 0===o.instance&&n(t),o.instance},r=t;(function(e,n){r(e,[],function(){return n})})("4",tinymce.util.Tools.resolve),r("1",["4"],function(e){return e("tinymce.PluginManager")}),r("2",["4"],function(e){return e("tinymce.util.I18n")}),r("3",["4"],function(e){return e("tinymce.util.Tools")}),r("0",["1","2","3"],function(e,n,t){return e.add("toc",function(e){function o(){var n=this;n.disabled(e.readonly||!r()),e.on("LoadContent SetContent change",function(){n.disabled(e.readonly||!r())})}function r(){return!(!d||!i(d).length)}function i(n){var o=function(e){var n,t=[];for(n=1;n<=e;n++)t.push("h"+n);return t.join(",")}(n.depth),r=l(o);return r.length&&/^h[1-9]$/i.test(n.headerTag)&&(r=r.filter(function(t,o){return!e.dom.hasClass(o.parentNode,n.className)})),t.map(r,function(e){return e.id||(e.id=m()),{id:e.id,level:parseInt(e.nodeName.replace(/^H/i,""),10),title:l.text(e)}})}function a(n,t){var o="</"+n+">";return"<"+n+' contenteditable="true">'+e.dom.encode(t)+o}function c(e){var t,o,r,c,d="",l=i(e),u=function(e){var n,t=9;for(n=0;n<e.length;n++)if(e[n].level<t&&(t=e[n].level),1==t)return t;return t}(l)-1;if(!l.length)return"";for(d+=a(e.headerTag,n.translate("Table of Contents")),t=0;t<l.length;t++){if(r=l[t],c=l[t+1]&&l[t+1].level,u===r.level)d+="<li>";else for(o=u;o<r.level;o++)d+="<ul><li>";if(d+='<a href="#'+r.id+'">'+r.title+"</a>",c!==r.level&&c)for(o=r.level;o>c;o--)d+="</li></ul><li>";else d+="</li>",c||(d+="</ul>");u=r.level}return d}var d,l=e.$,u=3,s="h2",f="mce-toc",m=function(e){var n=0;return function(){var t=(new Date).getTime().toString(32);return e+t+(n++).toString(32)}}("mcetoc_");e.on("PreInit",function(){var n=e.settings,t=parseInt(n.toc_depth,10)||0;d={depth:t>=1&&t<=9?t:u,headerTag:function(n){return!!n&&e.schema.isValidChild("div",n)}(n.toc_header)?n.toc_header:s,className:n.toc_class?e.dom.encode(n.toc_class):f}}),e.on("PreProcess",function(e){var n=l("."+d.className,e.node);n.length&&(n.removeAttr("contentEditable"),n.find("[contenteditable]").removeAttr("contentEditable"))}),e.on("SetContent",function(){var e=l("."+d.className);e.length&&(e.attr("contentEditable",!1),e.children(":first-child").attr("contentEditable",!0))});e.addCommand("mceInsertToc",function(){!function(n){return!n.length||e.dom.getParents(n[0],".mce-offscreen-selection").length>0}(l("."+d.className))?e.execCommand("mceUpdateToc"):e.insertContent(function(e){var n=c(e);return'<div class="'+e.className+'" contenteditable="false">'+n+"</div>"}(d))}),e.addCommand("mceUpdateToc",function(){var n=l("."+d.className);n.length&&e.undoManager.transact(function(){n.html(c(d))})}),e.addButton("toc",{tooltip:"Table of Contents",cmd:"mceInsertToc",icon:"toc",onPostRender:o}),e.addButton("tocupdate",{tooltip:"Update",cmd:"mceUpdateToc",icon:"reload"}),e.addContextToolbar(function(n){return n&&e.dom.is(n,"."+d.className)&&e.getBody().contains(n)},"tocupdate"),e.addMenuItem("toc",{text:"Table of Contents",context:"insert",cmd:"mceInsertToc",onPostRender:o})}),function(){}}),o("0")()}();