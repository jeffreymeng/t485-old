!function(){var e={},t=function(t){for(var n=e[t],i=n.deps,r=n.defn,o=i.length,a=new Array(o),c=0;c<o;++c)a[c]=l(i[c]);var d=r.apply(null,a);if(void 0===d)throw"module ["+t+"] returned undefined";n.instance=d},n=function(t,n,l){if("string"!=typeof t)throw"module id must be a string";if(void 0===n)throw"no dependencies for "+t;if(void 0===l)throw"no definition function for "+t;e[t]={deps:n,defn:l,instance:void 0}},l=function(n){var l=e[n];if(void 0===l)throw"module ["+n+"] was undefined";return void 0===l.instance&&t(n),l.instance},i=n;(function(e,t){i(e,[],function(){return t})})("7",tinymce.util.Tools.resolve),i("1",["7"],function(e){return e("tinymce.html.DomParser")}),i("2",["7"],function(e){return e("tinymce.html.Node")}),i("3",["7"],function(e){return e("tinymce.html.Serializer")}),i("4",["7"],function(e){return e("tinymce.PluginManager")}),i("5",["7"],function(e){return e("tinymce.util.Tools")}),i("6",["5"],function(e){return{protectHtml:function(t,n){return e.each(t,function(e){n=n.replace(e,function(e){return"\x3c!--mce:protected "+escape(e)+"--\x3e"})}),n},unprotectHtml:function(e){return e.replace(/<!--mce:protected ([\s\S]*?)-->/g,function(e,t){return unescape(t)})}}}),i("0",["1","2","3","4","5","6"],function(e,t,n,l,i,r){return l.add("fullpage",function(l){function o(e){function r(e,t,n){e.attr(t,n||void 0)}function o(e){u.firstChild?u.insert(e,u.firstChild):u.append(e)}var d,u,f,m,g,p=l.dom;d=a(),(u=d.getAll("head")[0])||(m=d.getAll("html")[0],u=new t("head",1),m.firstChild?m.insert(u,m.firstChild,!0):m.append(u)),m=d.firstChild,e.xml_pi?(g='version="1.0"',e.docencoding&&(g+=' encoding="'+e.docencoding+'"'),7!=m.type&&(m=new t("xml",7),d.insert(m,d.firstChild,!0)),m.value=g):m&&7==m.type&&m.remove(),m=d.getAll("#doctype")[0],e.doctype?(m||(m=new t("#doctype",10),e.xml_pi?d.insert(m,d.firstChild):o(m)),m.value=e.doctype.substring(9,e.doctype.length-1)):m&&m.remove(),m=null,s(d.getAll("meta"),function(e){"Content-Type"==e.attr("http-equiv")&&(m=e)}),e.docencoding?(m||((m=new t("meta",1)).attr("http-equiv","Content-Type"),m.shortEnded=!0,o(m)),m.attr("content","text/html; charset="+e.docencoding)):m&&m.remove(),m=d.getAll("title")[0],e.title?(m?m.empty():o(m=new t("title",1)),m.append(new t("#text",3)).value=e.title):m&&m.remove(),s("keywords,description,author,copyright,robots".split(","),function(n){var l,i,r=d.getAll("meta"),a=e[n];for(l=0;l<r.length;l++)if((i=r[l]).attr("name")==n)return void(a?i.attr("content",a):i.remove());a&&((m=new t("meta",1)).attr("name",n),m.attr("content",a),m.shortEnded=!0,o(m))});var h={};i.each(d.getAll("link"),function(e){"stylesheet"==e.attr("rel")&&(h[e.attr("href")]=e)}),i.each(e.stylesheets,function(e){h[e]||((m=new t("link",1)).attr({rel:"stylesheet",text:"text/css",href:e}),m.shortEnded=!0,o(m)),delete h[e]}),i.each(h,function(e){e.remove()}),(m=d.getAll("body")[0])&&(r(m,"dir",e.langdir),r(m,"style",e.style),r(m,"vlink",e.visited_color),r(m,"link",e.link_color),r(m,"alink",e.active_color),p.setAttribs(l.getBody(),{style:e.style,dir:e.dir,vLink:e.visited_color,link:e.link_color,aLink:e.active_color})),(m=d.getAll("html")[0])&&(r(m,"lang",e.langcode),r(m,"xml:lang",e.langcode)),u.firstChild||u.remove(),f=new n({validate:!1,indent:!0,apply_source_formatting:!0,indent_before:"head,html,body,meta,title,script,link,style",indent_after:"head,html,body,meta,title,script,link,style"}).serialize(d),c=f.substring(0,f.indexOf("</body>"))}function a(){return new e({validate:!1,root_name:"#document"}).parse(c)}var c,d,s=i.each;l.addCommand("mceFullPageProperties",function(){var e=function(){function e(e,t){var n=e.attr(t);return n||""}var t,n,r=a(),o={};return o.fontface=l.getParam("fullpage_default_fontface",""),o.fontsize=l.getParam("fullpage_default_fontsize",""),7==(t=r.firstChild).type&&(o.xml_pi=!0,(n=/encoding="([^"]+)"/.exec(t.value))&&(o.docencoding=n[1])),(t=r.getAll("#doctype")[0])&&(o.doctype="<!DOCTYPE"+t.value+">"),(t=r.getAll("title")[0])&&t.firstChild&&(o.title=t.firstChild.value),s(r.getAll("meta"),function(e){var t,n=e.attr("name"),l=e.attr("http-equiv");n?o[n.toLowerCase()]=e.attr("content"):"Content-Type"==l&&(t=/charset\s*=\s*(.*)\s*/gi.exec(e.attr("content")))&&(o.docencoding=t[1])}),(t=r.getAll("html")[0])&&(o.langcode=e(t,"lang")||e(t,"xml:lang")),o.stylesheets=[],i.each(r.getAll("link"),function(e){"stylesheet"==e.attr("rel")&&o.stylesheets.push(e.attr("href"))}),(t=r.getAll("body")[0])&&(o.langdir=e(t,"dir"),o.style=e(t,"style"),o.visited_color=e(t,"vlink"),o.link_color=e(t,"link"),o.active_color=e(t,"alink")),o}();l.windowManager.open({title:"Document properties",data:e,defaults:{type:"textbox",size:40},body:[{name:"title",label:"Title"},{name:"keywords",label:"Keywords"},{name:"description",label:"Description"},{name:"robots",label:"Robots"},{name:"author",label:"Author"},{name:"docencoding",label:"Encoding"}],onSubmit:function(t){o(i.extend(e,t.data))}})}),l.addButton("fullpage",{title:"Document properties",cmd:"mceFullPageProperties"}),l.addMenuItem("fullpage",{text:"Document properties",cmd:"mceFullPageProperties",context:"file"}),l.on("BeforeSetContent",function(e){function t(e){return e.replace(/<\/?[A-Z]+/g,function(e){return e.toLowerCase()})}var n,o,u,f,m,g="",p=l.dom;if(!(e.selection||(u=r.protectHtml(l.settings.protect,e.content),"raw"==e.format&&c||e.source_view&&l.getParam("fullpage_hide_in_source_view")))){0!==u.length||e.source_view||(u=i.trim(c)+"\n"+i.trim(u)+"\n"+i.trim(d)),-1!=(n=(u=u.replace(/<(\/?)BODY/gi,"<$1body")).indexOf("<body"))?(n=u.indexOf(">",n),c=t(u.substring(0,n+1)),-1==(o=u.indexOf("</body",n))&&(o=u.length),e.content=i.trim(u.substring(n+1,o)),d=t(u.substring(o))):(c=function(){var e,t="",n="";return l.getParam("fullpage_default_xml_pi")&&(t+='<?xml version="1.0" encoding="'+l.getParam("fullpage_default_encoding","ISO-8859-1")+'" ?>\n'),t+=l.getParam("fullpage_default_doctype","<!DOCTYPE html>"),t+="\n<html>\n<head>\n",(e=l.getParam("fullpage_default_title"))&&(t+="<title>"+e+"</title>\n"),(e=l.getParam("fullpage_default_encoding"))&&(t+='<meta http-equiv="Content-Type" content="text/html; charset='+e+'" />\n'),(e=l.getParam("fullpage_default_font_family"))&&(n+="font-family: "+e+";"),(e=l.getParam("fullpage_default_font_size"))&&(n+="font-size: "+e+";"),(e=l.getParam("fullpage_default_text_color"))&&(n+="color: "+e+";"),t+="</head>\n<body"+(n?' style="'+n+'"':"")+">\n"}(),d="\n</body>\n</html>"),f=a(),s(f.getAll("style"),function(e){e.firstChild&&(g+=e.firstChild.value)}),(m=f.getAll("body")[0])&&p.setAttribs(l.getBody(),{style:m.attr("style")||"",dir:m.attr("dir")||"",vLink:m.attr("vlink")||"",link:m.attr("link")||"",aLink:m.attr("alink")||""}),p.remove("fullpage_styles");var h=l.getDoc().getElementsByTagName("head")[0];g&&(p.add(h,"style",{id:"fullpage_styles"},g),(m=p.get("fullpage_styles")).styleSheet&&(m.styleSheet.cssText=g));var y={};i.each(h.getElementsByTagName("link"),function(e){"stylesheet"==e.rel&&e.getAttribute("data-mce-fullpage")&&(y[e.href]=e)}),i.each(f.getAll("link"),function(e){var t=e.attr("href");return!t||(y[t]||"stylesheet"!=e.attr("rel")||p.add(h,"link",{rel:"stylesheet",text:"text/css",href:t,"data-mce-fullpage":"1"}),void delete y[t])}),i.each(y,function(e){e.parentNode.removeChild(e)})}}),l.on("GetContent",function(e){e.selection||e.source_view&&l.getParam("fullpage_hide_in_source_view")||(e.content=r.unprotectHtml(i.trim(c)+"\n"+i.trim(e.content)+"\n"+i.trim(d)))})}),function(){}}),l("0")()}();