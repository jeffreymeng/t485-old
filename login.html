<!DOCTYPE html>
<html>

<head>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Join Troop 485 in Cupertino to experience an excellent Scouting experience">
    
    <link rel="apple-touch-icon" sizes="152x152" href="favicons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="favicons/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="favicons/favicon-16x16.png" sizes="16x16">
    
    <title>Log In - Troop 485</title>
    
    <!-- Custom CSS -->
    <link href="css/t485.css" rel="stylesheet">
    
</head>

<body style="background-color: white; margin: 20px 0px 20px 30px;">
    
    <div style="margin-bottom: 20px;">
        <a href="index.html">Home</a>
    </div>
    
    <button style="background-color: transparent; border: 0px; padding: 0px;" onclick="signIn();">
        <img src="img/google-sign-in.png"></img>
    </button>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-2.2.0.min.js"></script>

    <script src="js/t485.js"></script>

    <!-- Firebase -->
    <script src="https://cdn.firebase.com/js/client/2.2.1/firebase.js"></script>
    
    <!-- Clicky Web Analytics -->
    <script src="https://static.getclicky.com/js"></script>
    <script>try{clicky.init(100869133)}catch(e){}</script>
    <noscript><img alt="" src="https://in.getclicky.com/100869133ns.gif"></noscript>

    <script>
        /* global Firebase */
        /* global getVarsFromUrl */
        /* global auth */
     
     
    
        auth(function() {
            redirectUser(redirectUrl);
        }, function() {});
    
    
        var redirectUrl = getVarsFromUrl()['redirect'] || '';
        var ref = new Firebase('https://t485auth.firebaseio.com');
        
        var members;
        $.get('members', function (response) {
            members = response.split('\n');
            
            ref.onAuth(onAuthCallback);
        });


        function onAuthCallback(authData) {
            if (authData !== null) {
                // Login succeeded
                var email = authData.google.email;
    
                // Check if email is on approved list
                if (members.indexOf(email) > -1) {
                    redirectUser(redirectUrl);
                } else {
                    alert('Sorry, but you are not authorized to view this page.');
                    redirectUser('index.html');
                }
            }
        }

    
        function signIn() {
            // ref.authWithOAuthRedirect('google', function(error) {
            ref.authWithOAuthPopup('google', function(error) {
                if (error) console.error('Login failed! ' + error);
            }, {
                remember: 'sessionOnly',
                scope: 'email'
            });
        }
    

        function redirectUser(url) {
            if (url !== '') {
                window.location.href = url;
            }
        }
    </script>
    
</body>

</html>