<!DOCTYPE html>
<html>

<head>

    <title>Log In - Troop 485</title>
<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet" type="text/css">
  <script src="https://apis.google.com/js/api:client.js"></script>
  
</head>

<body>

    <div class="container">

        <div class="row">
            <div class="box">
                <div class="col-lg-12">
                    <hr>
                    <h2 class="intro-text text-center">Log In</h2>
                    <hr>
                </div>
                <div class="col-md-12">
                    <p>
                        <div id="my-signin2"></div>

                    </p>
                </div>
                <div class="clearfix"></div>
            </div>
            
        </div>

    </div>
    <!-- /.container -->
  <script>
  var redirectUrl = getVarsFromUrl()['redirect'] || '';
  function redirectUser(url) {
      window.location.href = url;
  }
    function onSuccess(googleUser) {
      console.log('Logged in as: ' + googleUser.getBasicProfile().getEmail());
      var members;
        $.get('members', function(response) {
            members = response.split('\n');
            if (googleUser !== null) {
                // Login succeeded
                localStorage.setItem("userEmail", googleUser.getBasicProfile().getEmail())
                localStorage.setItem("userInfo", googleUser)
                var email = googleUser.getBasicProfile().getEmail();
                // Check if email is on approved list
                if (members.indexOf(email) > -1) {
                    redirectUser(redirectUrl);
                }
                else {
                    alert('Sorry, but you are not authorized to view this page.');
                    redirectUser('home.html');
                }
            }
<<<<<<< HEAD
        });
       

    }
    function onFailure(error) {
      console.log(error);
    }
    function renderButton() {
      gapi.signin2.render('my-signin2', {
        'scope': 'profile email',
        'width': 240,
        'height': 50,
        'longtitle': true,
        'theme': 'dark',
        'onsuccess': onSuccess,
        'onfailure': onFailure
      });
    }
    
  </script>

  
=======
        }


        console.log('defining sign in');

        function signIn() {
            var provider = new firebase.auth.GoogleAuthProvider();
            provider.addScope('https://www.googleapis.com/auth/userinfo.email');
            provider.addScope('https://www.googleapis.com/auth/userinfo.profile');

            firebase.auth().signInWithPopup(provider).then(function(result) {
                // This gives you a Google Access Token. You can use it to access the Google API.
                var token = result.credential.accessToken;
                // The signed-in user info.
                var user = result.user;
                console.log(user);
                $.get("https://www.googleapis.com/oauth2/v1/userinfo?alt=json&access_token=" + token, "", function (d) {console.log(d);}, "json");
                // ...
            }).catch(function(error) {
                // Handle Errors here.
                var errorCode = error.code;
                var errorMessage = error.message;
                // The email of the user's account used.
                var email = error.email;
                // The firebase.auth.AuthCredential type that was used.
                var credential = error.credential;
                // ...
            });
        }


        function redirectUser(url) {
            if (url !== '') {
                loadPage(url);
            }
        }
    </script>
>>>>>>> 9863c66b1c56669348ac983bef3840aee179cf37

</body>

</html>