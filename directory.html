<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Join Troop 485 in Cupertino to experience an excellent Scouting experience">
    <meta name="author" content="Richard Liu">

    <link rel="apple-touch-icon" sizes="144x144" href="favicons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="favicons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="favicons/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="favicons/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="favicons/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="favicons/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="favicons/manifest.json">
    <meta name="theme-color" content="#008000">

    <title>Directory - Troop 485</title>

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/t485.css" rel="stylesheet">

    <!-- Fonts -->
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Josefin+Slab:100,300,400,600,700,100italic,300italic,400italic,600italic,700italic" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

    <a href="index.html"><img src="img/header.gif" id="header" alt="Troop 485"></a>

    <!-- Navigation -->
    <nav class="navbar navbar-default" role="navigation">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <!-- navbar-brand is hidden on larger screens, but visible when the menu is collapsed -->
                <a class="navbar-brand" href="index.html">T485</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li>
                        <a href="index.html">Home</a>
                    </li>
                    <li>
                        <a href="about.html">About</a>
                    </li>
                    <li>
                        <a href="calendar.html">Calendar</a>
                    </li>
                    <li>
                        <a href="new-scout.html">New Scout</a>
                    </li>
                    <li>
                        <a href="troop-jobs.html">Troop Jobs</a>
                    </li>
                    <li>
                        <a href="pictures.html">Pictures</a>
                    </li>
                    <li class="dropdown">
                        <a>FAQ <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="faq.html">FAQ</a></li>
                            <li><a href="merit-badges.html">Merit Badges</a></li>
                            <li><a href="eagle.html">Path to Eagle</a></li>
                            <li><a href="smc.html">SMC &amp; BOR</a></li>
                            <li><a href="plc.html">What is PLC?</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a>Resources <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="resources.html">Resources</a></li>
                            <li><a href="meeting-minutes.html">Meeting Minutes</a></li>
                            <li><a href="books.html">Books</a></li>
                        </ul>
                    </li>
                    <li class="dropdown active">
                        <a>Directory <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li class="active"><a href="directory.html" class="active">Directory</a></li>
                            <li><a href="contact.html">Enter Contact Information</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <div id="toTop"></div>

    <div class="alert alert-info alert-dismissible" role="alert">
        <a class="close" data-dismiss="alert">Ã—</a>
        <span class="glyphicon glyphicon-info-sign"></span>  Click <a href="feedback.html" style="color: darkred;">here</a> to submit feedback to help me improve the website!
    </div>

    <div class="container">

        <div class="row" id="password-form">
            <div class="box">
                <div class="form-group input-append">
                    <label for="password">This section is password protected:</label>
                    <input type="password" class="form-control" id="password">
                    <button type="submit" class="btn btn-default" id="submit">Submit</button>
                    <span class="glyphicon glyphicon-remove form-control-feedback" aria-hidden="true"></span>
                    <span id="inputError2Status" class="sr-only">(error)</span>
                </div>
            </div>
        </div>

        <div class="row" id="search" style="display: none;">
            <div class="box col-xs-12">
                <hr>
                <h2 class="intro-text text-center">Search</h2>
                <hr>
                <p>Click on the name for more information.</p>
                <p>Notice someone's name is missing? Click <a href="feedback.html">here</a> to submit the bug.</p>
                <div class="input-group col-xs-12">
                    <input type="text" class="form-control" placeholder="Type a name..." id="search-query">
                    <span class="input-group-btn" style="vertical-align: top">
                        <button class="btn btn-default" type="button" id="search-btn">
                            <i class="glyphicon glyphicon-search"></i>
                        </button>
                    </span>
                </div>
                <table class="table" id="results" style="display: none;">
                    <thead>
                        <tr>
                            <th class="col-xs-3">Name</th>
                            <th class="col-xs-3">Cell Phone</th>
                            <th class="col-xs-3">Father's Cell Phone</th>
                            <th class="col-xs-3">Mother's Cell Phone</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                <div id="detail" style="display: none;"></div>
            </div>
        </div>

        <div class="row" id="spreadsheet-confirm" style="display: none;">
            <div class="box">
                <button type="button" id="spreadsheet-confirm-btn" class="btn btn-default">Show full directory</button>
            </div>
        </div>

        <div class="row" id="spreadsheet" style="display: none;">
            <div class="box">
                <ul class="nav nav-tabs">
                    <li class="active"><a data-toggle="tab" href="#cacti">Cacti</a></li>
                    <li><a data-toggle="tab" href="#wildcats">Wildcats</a></li>
                    <li><a data-toggle="tab" href="#hawks">Hawks</a></li>
                    <li><a data-toggle="tab" href="#serpents">Serpents</a></li>
                    <li><a data-toggle="tab" href="#old-contact">Old Directory</a></li>
                </ul>

                <div class="tab-content" id="spreadsheet-content"></div>
            </div>
        </div>

    </div>
    <!-- /.container -->

    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-12 text-center">
                    <p>Copyright &copy; 2015 Troop 485, Silicon Valley Monterey Bay Council, Boy Scouts of America</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="js/jquery.js"></script>

    <script src="js/t485.js"></script>
    <script src="js/tabletop.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>

    <!-- Firebase -->
    <script src="https://cdn.firebase.com/js/client/2.2.1/firebase.js"></script>

    <!-- Clicky Web Analytics -->
    <script src="https://static.getclicky.com/js"></script>
    <script>try{clicky.init(100869133)}catch(e){}</script>
    <noscript><img alt="Clicky" src="https://in.getclicky.com/100869133ns.gif"></noscript>

    <script>
        $("#submit").click(checkPassword);
        $("#password").keypress(function (e){
            if(e.keyCode === 13) {
                $("#submit").click();
            }
        });
        $("#spreadsheet-confirm-btn").click(function () {
            $("#spreadsheet-confirm").css("display", "none");
            $("#spreadsheet-content").html(
                "<div id=\"cacti\" class=\"tab-pane fade in active\">" +
                    "<a href=\"https://docs.google.com/spreadsheets/d/1FUlVVgMz1IgP68LExESAFwokIGc5zWUq6mEk5auKiSU/edit?usp=drive_web\" target=\"_blank\">Edit Spreadsheet</a>" +
                    "<iframe src=\"https://docs.google.com/spreadsheets/d/1FUlVVgMz1IgP68LExESAFwokIGc5zWUq6mEk5auKiSU/pubhtml?widget=true&amp;headers=false\"></iframe>" +
                "</div>" +
                "<div id=\"wildcats\" class=\"tab-pane fade\">" +
                    "<a href=\"https://docs.google.com/spreadsheets/d/1pEWKoQjXaekpDKfZSkAuKt0WCDKNfBIckMbDV-5m31Y/edit?usp=drive_web\" target=\"_blank\">Edit Spreadsheet</a>" +
                    "<iframe src=\"https://docs.google.com/spreadsheets/d/1pEWKoQjXaekpDKfZSkAuKt0WCDKNfBIckMbDV-5m31Y/pubhtml?widget=true&amp;headers=false\"></iframe>" +
                "</div>" +
                "<div id=\"hawks\" class=\"tab-pane fade\">" +
                    "<a href=\"https://docs.google.com/spreadsheets/d/1NUCXRoB3Z2Su-KCG5bTNna3nxNEYHO3KK3n3lIL0wTk/edit?usp=drive_web\" target=\"_blank\">Edit Spreadsheet</a>" +
                    "<iframe src=\"https://docs.google.com/spreadsheets/d/1NUCXRoB3Z2Su-KCG5bTNna3nxNEYHO3KK3n3lIL0wTk/pubhtml?widget=true&amp;headers=false\"></iframe>" +
                "</div>" +
                "<div id=\"serpents\" class=\"tab-pane fade\">" +
                    "<a href=\"https://docs.google.com/spreadsheets/d/1GHWUQD86AGYW5H4M-YnU3c97gFMayzmdVLf2iG8ioEc/edit?usp=drive_web\" target=\"_blank\">Edit Spreadsheet</a>" +
                    "<iframe src=\"https://docs.google.com/spreadsheets/d/1GHWUQD86AGYW5H4M-YnU3c97gFMayzmdVLf2iG8ioEc/pubhtml?widget=true&amp;headers=false\"></iframe>" +
                "</div>" +
                "<div id=\"old-contact\" class=\"tab-pane fade\">" +
                    "<p>This is the old directory. Use this one until the patrol leaders update their patrol's directory.</p>" +
                    "<iframe src=\"https://docs.google.com/spreadsheets/d/1vG2y2euWgG3ASuSpBC9oD5ufZ8YiL4Q-HlPYyKaZ_o0/pubhtml?widget=true&amp;headers=false\"></iframe>" +
                "</div>"
            );
            $("#spreadsheet").css("display", "block");
        });
        checkCookie();

        function setCookie(cname, cvalue, exdays) {
            var d = new Date();
            d.setTime(d.getTime() + (exdays*24*60*60*1000));
            var expires = "expires="+d.toUTCString();
            document.cookie = cname + "=" + cvalue + "; " + expires;
        }
        function getCookie(cname) {
            var name = cname + "=";
            var ca = document.cookie.split(";");
            for(var i=0; i<ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0)==" ") c = c.substring(1);
                if (c.indexOf(name) == 0) return c.substring(name.length, c.length);
            }
            return "";
        }

        function checkPassword() {
            var password = $("#password").val();
            // Hash function from http://werxltd.com/wp/2010/05/13/javascript-implementation-of-javas-string-hashcode-method/
            var hash = function(s) {
                var h = 0, i, c, l = s.length;
                if (l == 0) return h;
                for (i = 0; i < l; i++) {
                    h = ((h<<5) - h) + s.charCodeAt(i);
                    h |= 0; // Convert to 32bit integer
                }
                return h;
            };

            if (hash(password) === 3208057) {
                $("#password-form").css("display", "none");
                $("#search").css("display", "block");
                $("#spreadsheet-confirm").css("display", "block");
                $("#search-query").focus();

                setCookie("logged-in", "true", 7);
            } else {
                $(".form-group").addClass("has-error has-feedback");
                $("#password").val("");
            }
        }

        function checkCookie() {
            if (getCookie("logged-in") === "true") {
                $("#password-form").css("display", "none");
                $("#search").css("display", "block");
                $("#spreadsheet-confirm").css("display", "block");
                $("#search-query").focus();
            }
        }


        window.globalData = [];
        $(document).ready(function() {
            $("#password").focus();
        });

        // Cacti
        Tabletop.init({key: "1FUlVVgMz1IgP68LExESAFwokIGc5zWUq6mEk5auKiSU", callback: addData, simpleSheet: true});
        // Wildcats
        Tabletop.init({key: "1NUCXRoB3Z2Su-KCG5bTNna3nxNEYHO3KK3n3lIL0wTk", callback: addData, simpleSheet: true});
        // Hawks
        Tabletop.init({key: "1pEWKoQjXaekpDKfZSkAuKt0WCDKNfBIckMbDV-5m31Y", callback: addData, simpleSheet: true});
        // Serpents
        Tabletop.init({key: "1GHWUQD86AGYW5H4M-YnU3c97gFMayzmdVLf2iG8ioEc", callback: addData, simpleSheet: true});
        function addData(data, t) {
            window.globalData.push.apply(window.globalData, data);
            console.log("initializing tabletop, 4 times");
        }

        $("#search-query").keypress(function(e){
            if(e.keyCode === 13) {
                $("#search-btn").click();
            }
        });
        $("#search-btn").click(function() {
            var userquery = $("#search-query").val();
            $("#search-query").val("");
            userquery = userquery.toLowerCase();
            //console.log(userquery);
            var query = [];
            if (userquery.search(" ") > 0) {
                query = userquery.split(" ");
            } else {
                query[0] = userquery;
                query[1] = 0;
            }

            //console.log(window.globalData);
            //console.log(query);

            // Split the names into first and last names
            var patrolnames = [];
            for (var i = 0; i < window.globalData.length; i++) {
                var fullname = window.globalData[i]["Scout's Full Name (last name first):"];
                var name;
                if (fullname.search(", ") > 0) {
                    name = fullname.split(", ");
                    var temp = name[0];
                    name[0] = name[1];
                    name[1] = temp;
                } else if (fullname.search(" ") > 0) {
                    name = fullname.split(" ");
                } else if (fullname.search(",") > 0) {
                    name = fullname.split(",");
                    var temp = name[0];
                    name[0] = name[1];
                    name[1] = temp;
                } else {
                    name = "ERROR";
                    console.error("Unable to split given full name into first and last name");
                }
                name[0] = name[0].toLowerCase();
                name[1] = name[1].toLowerCase();
                patrolnames.push(name);
            }
            //console.log(patrolnames);

            // Search for patrolnames for query
            var results = [];
            // score is between 0 and 10. lower is better
            var score = [];
            for (var i = 0; i < patrolnames.length; i++) {
                // Only first/last name
                if (query[1] === 0) {
                    if (patrolnames[i][0] === query[0] || patrolnames[i][1] === query[0]) {
                        score.push({id: i, score: 0});
                    } else if (query[0].length === patrolnames[i][0].length) {
                        var diff = compare(query[0], patrolnames[i][0], 0.5);
                        if (diff != 10) {
                            score.push({id: i, score: diff + 1});
                        }
                    } else if (query[0].length === patrolnames[i][1].length) {
                        var diff = compare(query[0], patrolnames[i][1], 0.5);
                        if (diff != 10) {
                            score.push({id: i, score: diff + 1});
                        }
                    }
                // If first or last name is query's first and last name set score to 0
                } else if (patrolnames[i][0] === query[0] && patrolnames[i][1] === query[1]) {
                    score.push({id: i, score: 0});
                }
            }
            score.sort(function(a, b) {
                return parseFloat(a.score) - parseFloat(b.score);
            });
            for (var i = 0; i < score.length; i++) {
                if (score[i].score === 0) {
                    results.push(score[i].id);
                    break;
                } else if (score[i].score === 1) {
                    results.push(score[i].id);
                }
            }

            // Display search results
            $("#results").css("display", "block");
            $("#detail").css("display", "none")
            $("#results > tbody").html("");
            for (var i = 0; i < results.length; i++) {
                var name = window.globalData[results[i]]["Scout's Full Name (last name first):"];
                $("#results > tbody").append(
                    "<tr><td><a onclick=\"showfullinfo(" + results[i] + ")\">" + name
                 + "</a></td><td>"  + window.globalData[results[i]]["Scout's Cell Phone"]
                 + "</td><td>"      + window.globalData[results[i]]["Father's Cell Phone"]
                 + "</td><td>"      + window.globalData[results[i]]["Mother's Cell Phone"] + "</td></tr>");
            }
        });

        function showfullinfo(id) {
            $("#results").css("display", "none");
            $("#detail").css("display", "block").html("").append(
                "Name: "                + window.globalData[id]["Scout's Full Name (last name first):"] + "<br>" +
                "Email: "               + window.globalData[id]["Scout's E-mail:"] + "<br>" +
                "Cell Phone: "          + window.globalData[id]["Scout's Cell Phone"] + "<br>" +
                "Home Phone: "          + window.globalData[id]["Scout's Home Phone"] + "<br>" + "<br>" +
                "Father's Cell Phone: " + window.globalData[id]["Father's Cell Phone"] + "<br>" +
                "Father's E-mail: "     + window.globalData[id]["Father's E-mail"] + "<br>" + "<br>" +
                "Mother's Cell Phone: " + window.globalData[id]["Mother's Cell Phone"] + "<br>" +
                "Mother's E-mail: "     + window.globalData[id]["Mother's E-mail"] + "<br>"
            );
        }

        function compare(a, b, threshold) {
            // Comparing a to b
            // Loop through every character in the name
            var percent = 0;
            for (var i = 0; i < b.length; i++) {
                if (a[i] !== b[i]) {
                    percent += 1;
                }
            }
            // Score is less is better!
            if (percent / b.length < threshold) {
                return percent / b.length;
            } else {
                return 10;
            }
        }
    </script>

</body>

</html>
