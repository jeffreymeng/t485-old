<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Join Troop 485 in Cupertino to experience an excellent Scouting experience">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <link rel="apple-touch-icon" sizes="152x152" href="favicons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="favicons/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="favicons/favicon-16x16.png" sizes="16x16">

    <title>Directory - Troop 485</title>

    <!-- Bootstrap Core CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/t485.css" rel="stylesheet">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Josefin+Slab:100,300,400,600,700,100italic,300italic,400italic,600italic,700italic" rel="stylesheet" type="text/css">

</head>

<body>

    <a href="index.html" class="skrollr" data-0="top: 0px;" data-150="top: 86%;"><img src="img/header.gif" id="header" alt="Troop 485 banner" width="990" height="151"></a>
    
    <div id="filler"></div>

    <!-- Navigation -->
    <nav class="navbar navbar-default">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <!-- navbar-brand is hidden on larger screens, but visible when the menu is collapsed -->
                <a class="navbar-brand" href="index.html">T485</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li>
                        <a href="index.html">Home</a>
                    </li>
                    <li>
                        <a href="calendar.html">Calendar</a>
                    </li>
                    <li>
                        <a href="new-scout.html">New Scout</a>
                    </li>
                    <li>
                        <a href="pictures.html">Pictures</a>
                    </li>
                    <li class="dropdown">
                        <a>Blogs <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="blog/dragons/">Dragons</a></li>
                            <li><a href="blog/blobfish/">Blobfish</a></li>
                            <li><a href="blog/hawks/">Hawks</a></li>
                            <li><a href="blog/cacti/">Cacti</a></li>
                            <li><a href="blog/serpents/">Serpents</a></li>
                            <li><a href="blog/wildcats/">Wilcats</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a>FAQ <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="faq.html">FAQ</a></li>
                            <li><a href="merit-badges.html">Merit Badges</a></li>
                            <li><a href="eagle.html">Path to Eagle</a></li>
                            <li><a href="smc.html">SMC &amp; BOR</a></li>
                            <li><a href="plc.html">What is PLC?</a></li>
                            <li><a href="about.html">About</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a>Resources <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="resources.html">Resources</a></li>
                            <li><a href="meeting-minutes.html">Meeting Minutes</a></li>
                            <li><a href="books.html">Books</a></li>
                            <li><a href="troop-jobs.html">Troop Jobs</a></li>
                            <li><a href="ranks.html">Ranks</a></li>
                            <li><a href="forum.html">Forum</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="directory.html">Directory</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <a href="#" id="toTop"></a>

    <div class="alert alert-info alert-dismissible" role="alert">
        <a class="close" data-dismiss="alert">Ã—</a>
        <span class="glyphicon glyphicon-info-sign"></span>  Click <a href="feedback.html" style="color: darkred;">here</a> to submit feedback to help me improve the website!
    </div>

    <div class="container">
        
        <div class="row" id="search">
            <div class="box col-xs-12">
                <hr>
                <h2 class="intro-text text-center">Search</h2>
                <hr>
                <p><button class="btn btn-default" onclick="window.location.href='logout.html?redir=directory.html'">Log out</button></p>
                <p>Click on the name for more information.</p>
                <div class="input-group col-xs-12">
                    <input type="text" id="search-query" class="form-control" placeholder="Type a name...">
                    <span class="input-group-btn" style="vertical-align: top">
                        <button class="btn btn-default" type="button" id="search-btn">
                            <i class="glyphicon glyphicon-search"></i>
                        </button>
                    </span>
                </div>
                
                <table class="table" id="results" style="display: none;">
                    <thead>
                        <tr>
                            <th class="col-xs-1">Name</th>
                            <th class="col-xs-1">Cell Phone</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                <p id="no-result" style="display: none;"></p>
                <div id="detail" style="display: none;"></div>
            </div>
        </div>

        <div class="row" id="spreadsheet-confirm">
            <div class="box">
                <button type="button" id="spreadsheet-confirm-btn" class="btn btn-default">Show spreadsheet</button>
            </div>
        </div>

        <div class="row" id="spreadsheet" style="display: none;">
            <div class="box">
                <ul class="nav nav-tabs no-fancy-navbar">
                    <li class="active"><a data-toggle="tab" href="#cacti">Cacti</a></li>
                    <li><a data-toggle="tab" href="#wildcats">Wildcats</a></li>
                    <li><a data-toggle="tab" href="#hawks">Hawks</a></li>
                    <li><a data-toggle="tab" href="#serpents">Serpents</a></li>
                    <li><a data-toggle="tab" href="#blobfish">Blobfish</a></li>
                    <li><a data-toggle="tab" href="#dragons">Dragons</a></li>
                </ul>

                <div class="tab-content" id="spreadsheet-content"></div>
            </div>
        </div>
        
    </div>
    <!-- /.container -->

    <footer>
        <div class="container">
            <div class="box">
                <div class="col-lg-12 text-center">
                    <p>Copyright &copy; 2006-2016 Troop 485, Silicon Valley Monterey Bay Council, Boy Scouts of America</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
    
    <script src="https://bitwiseshiftleft.github.io/sjcl/sjcl.js"></script>

    <script src="js/skrollr-0.6.30.min.js"></script>
    <script src="js/t485.js"></script>
    <script src="js/tabletop.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

    <!-- Clicky Web Analytics -->
    <script src="https://static.getclicky.com/js"></script>
    <script>try{clicky.init(100869133)}catch(e){}</script>
    <noscript><img alt="" src="https://in.getclicky.com/100869133ns.gif"></noscript>

    <script>
        /* global Tabletop */
        
        
        var text = 
        '{"iv":"Ngd49b+6DN8+0o4vDy+YrA==","v":1,"iter":1000,"ks":128,"ts":64,"mode":"ccm","adata":"","cipher":"aes","salt":"zhOhql8OlNU=","ct":"XRYzs1ERWY7n5mh3fQgEe4xIYtZHng3Ulqsf4ll9QKR+NMeEQaPzi7Wg7lDKkzpoMSn7AkoJ/e96LhBW5Lw+UibN5eDM5Qe+vVCf+38dfze6AzO066QL9dMDhqS508DawV59TnD1xN/vM5Zs22mtgJRkLsatis73m7iiuv3LjOGc0w99vMyjTZX2Ku8B9KjH5IAZUtvjsfNX+O/HGK9CSUIaXCuEVo1vs0HkNWL6JSqgR+gjE67rH1/XL54M/GFVe7PfYhEDPRPOhc2mvxjDS4eX' +
        'SgOw9ZLSRYf1IP/byYyF35o3Jzir+6CLY/h4dsXYxAJ9TodyiyiMOOLyeOJCJL+zsSrqEmjk1NaAAGvxgMEBjbo/wnVgVrN4PAqJ1GIJVPUenKoa5peDCxoLGO3Mk8visnc4sbMtH3ImoOVNTydlpfOkArrKhxrhyC9S9trN6i3YicajO1AvfPHRrow0Ohcy4etJtVpNEl1FB8JfWk2YbghAv3RlraVXnM2GbCpMEJUEZcQBx6vq6PhAR1gM+WpXAd4p4pjGnvJsLXFmuuTyegfztuCQFfPZabSTPLWE7+wTGEj279SPsEh4Z3nYI1dNxFiyerCQNUBig4/Se8QxvcTF2/dKt/mDhSXdSl5qV1jiWX/eGLt4gnk12aBZhcdsRcEPp9XEpmRm4B1V/X9o1ErgK3tibY8Ireg5EpUOl' +
        'nM6hjUvfJiEP8Yd16DL9dOQ4VrZzluuPsRQ/q72a1SR+RbGJ+qwQKLfxNJUzh18jjTNZrJP0UTDz371EmCyTrRKHpA1N4hR/npx2YXm9cvIVArFg2sm3yFi6qt5LQpoqJ8d0MFZ0MqehZwV4nu1HGJZnjaw9DVMqzMrhQoJb67+iBNKyvpoNDwOGu3ABpIXZVbkyKU5oyOCPb5hc7Zlz2kGJgD5BdZ7gSZWjSVg1uaOkFNe+gC3YcWvRKeiLMTy8sphEgh5gtfmrvP85KE6skewVgaHIm8crJXiUKPY2t6YeCcLi1Jxr938UhT43bPqkYx/XVzBkTtjC/H9rg68nUYlxyxzCWCPU4K8wMwnjX5fP+E54tki2vra4t31qu7HitmAOsuEmDJV9/FRMe524CiDeW7xeYk2' +
        '77eH0ilaW8h4IWlg+590IWnHvwNzep8G40RtRR5xwjQdsJSxt9h61Hp60MYFDZl/TyvDeuXZ4yfWnVzkm1jX3Bg7F6MQlIxSkxEFCzBJkqhjaB3oh1MRwkCDoSxjVTT5kkSa/W/XMmM8UTvMsnwiR85pG6haWmJ4OrPHxcQJbd8mQB+12CuMn+Sp3MC8kWn50u+GrfuTmsdrfh1gPrzMMMg8nwSV9XfCq3nDwHRvun1IW4PbWJU6dOCjFCa3vjUC3j8r1YsO2+Mw75e9mZEovm9+MQ0uEv3OSdL7t5qS86NolAfHt/vbepNi6rPfGoBQmtPFE1A6FMDzXIjaWlQdOwHhYhmK65eIY3eUlKnN4AGiHyT/DRvMfobUazunkoDwxEhWLbTg2MzPUBTud3DrbFNFQsKZuDap3eaf1i5te' +
        '44TAEAp5tWt7rIkOco9YmTL91Ei+UBcsJUrJZXS0HgfZQ18UMS+iK5uDL8yf6ONBMq7Y5WH4Spv91tyusakIi/7QTu8uzU+O6LdHi5MyW7vcwwK4/4agmVjpR5RPCsadqv8CW1g/WIz98ERLD1ZXoOGpTjOz4su/koWN8GdQhtHJ+cHjWpikKgqT9gS+raC1qvHps+K7RrVL8shsS6JU6n/ptciiuBfMTTeA9OkiECxsYlsF3mA5erMEm3t44DWE8c27AQfoE2F2bjSYHxKWEYythRNpFBWQWp4pTOx2K8e1h8ma1kuDut0u6VAPdaKTIy+Ie1O55RKIGBCs5hNGxgTjvp1fy7WXTfnOFs/hGmEUM8Kj3/lVG45FG9ni7O5TlhCrcFHHXVT/QpikGkcX+dXEwWsJdO/' +
        'kZIXhToA8tOzoGPSgFRD+JtJiDFKop+CYVJpsf6UjcyRlJRzd5IFiXdD2XjUuqUBoez2hAPjOdatKi7KkzfqX7psfikfxTdsqWkZquPDwH2Bns5Kt163K2ItOaHfjg6UcD10NpbxuwQnP6nKsNiV3VYP2Mi6PuBLuXrsiS8clBrbsjHpvlpgeeqNIdJJL+cKk9vnj0xQ0zy4uWZSg0OWZjjwI1KFpv+7QIKtnbMGVr1Go3TBeiQo5uSHpno5nydtk96w3JzC8hIxUXuAzqIdLQW7r9J3smHqxCT/U5QOVkOXxggEMNbYSQRAc1siR7etg4ms/qBUv7ukNoB8zBkpqb4mQ3/mup/3B/fIxGm1vgyNoEGagCpCQtz6wRqmu7lY23YnflaXL4U+CbTPWaSiGHDnbN21Jo36Ggo23Hexp' +
        'lRjGCiBW4fLe91kx6LSrasqICIER8bdNV4LKyDuE8QO55FgFsw4AxONkaPxXhbCafmCYTTqcjGLKdbdPrCi3qqt3ZldYZbOqpLcgTE4UhBMlPv1bGh/piMnTrdCK7Q6Sio63IQV2mSB0z5m47riCC71GQVmt3wECrrqYJN0iM5CXSPDTLr2ZB9t3r7vYIiUuLxB7MXNZNDW2HNrKpF3ifAuahXl1twJGEEzqaCrltAhe42Op/kSFfjis4jaHMkSs1P1i5+k+rca8NdjnDdiUCHq/3MDxxsVXjFaTovRK/XnpkZUq/WZ86HKv+wJXujhxNIREj3A5LH6lFvuyWijl6rWTEPaORrZpbov40rCqjeHGbs/9lxXRheSVY//A62lMGv7B7e7IgVurpOVOv23ZUthfyZjEdPM' +
        'Z8LvZTq8DFEHqhdsNVFa3LaICfShYS7wMuPiyqNmdjC+PR9QNXHm4hnC88fdWLH3vIG8FsrKlcid79i545/oYB9n6Jl882kfupQUgWAwTB2APfORvxgmk8+BOYBH/YKVPSQO0MaQHPcdI9P5MNToMQvAN5MZhF4yTtByjd9iuOS5oboVVQAzt/ajTSlQyQDSxQJu7iT4BY0tq4pR0PUarGs6eRUqQq53JVoXGcVx7sOkUOLLuE4ZxOQu/xaZw1rKPffHApd1psXKuGyUTytZhvv/j8rBZkKKn3dh8yXNtxLSWGzjKRth6Ely2fn+71LMFwwUAfY81qyHXpjveQp98sLqh5NoCt1c/eCshUIMb79IbULTDzWe1zwfQrYHRS0tr+r+posZHy3sb0xZVlAoBED8malz4yDSOz1sYBx8Vgyb9gEr6fZGBaBKpnuoCMzti08="}';
        var secretInfo;
        
        
        
        auth(function(authData) {
            text = sjcl.decrypt(authData.token, text);
            secretInfo = JSON.parse(text);
            
            $('#search-query').focus();
            
            
            $('#spreadsheet-confirm-btn').click(function () {
                $('#spreadsheet-confirm').hide();
                $('#spreadsheet-content').html(secretInfo.spreadsheets);
                $('#spreadsheet').show();
            });
            
            
            // Cacti
            Tabletop.init({key: secretInfo.tabletop.cacti, callback: function (data) {
                for (var i = 0; i < data.length; i++) {
                    data[i].patrol = 'Cacti';
                }
                window.globalData.push.apply(window.globalData, data);
            }, simpleSheet: true});
            
            // Hawks
            Tabletop.init({key: secretInfo.tabletop.hawks, callback: function (data) {
                for (var i = 0; i < data.length; i++) {
                    data[i].patrol = 'Hawks';
                }
                window.globalData.push.apply(window.globalData, data);
            }, simpleSheet: true});
            
            // Wildcats
            Tabletop.init({key: secretInfo.tabletop.wildcats, callback: function (data) {
                for (var i = 0; i < data.length; i++) {
                    data[i].patrol = 'Wildcats';
                }
                window.globalData.push.apply(window.globalData, data);
            }, simpleSheet: true});
            
            // Serpents
            Tabletop.init({key: secretInfo.tabletop.serpents, callback: function (data) {
                for (var i = 0; i < data.length; i++) {
                    data[i].patrol = 'Serpents';
                }
                window.globalData.push.apply(window.globalData, data);
            }, simpleSheet: true});
            
            // Blobfish
            Tabletop.init({key: secretInfo.tabletop.blobfish, callback: function (data) {
                for (var i = 0; i < data.length; i++) {
                    data[i].patrol = 'Blobfish';
                }
                window.globalData.push.apply(window.globalData, data);
            }, simpleSheet: true});
            
            // Dragons
            Tabletop.init({key: secretInfo.tabletop.dragons, callback: function (data) {
                for (var i = 0; i < data.length; i++) {
                    data[i].patrol = 'Dragons';
                }
                window.globalData.push.apply(window.globalData, data);
            }, simpleSheet: true});
        }, function() {
            window.location.href = 'login.html?redirect=directory.html';
        });
        
        
        
        window.globalData = [];
        $(document).ready(function() {
            $('#password').focus();
        });
        
        
        
        $('#search-query').keypress(function(e){
            if(e.keyCode === 13) {
                $('#search-btn').click();
            }
        });
        
        
        $('#search-btn').click(function() {
            var userquery = $('#search-query').val();
            if (userquery === '') return;
            
            
            $('#search-query').val('');
            userquery = userquery.toLowerCase();
            //console.log(userquery);
            var query = [];
            
            if (userquery.search(' ') > 0) {
                query = userquery.split(' ');
            } else {
                query[0] = userquery;
                query[1] = null;
                // If more than one space use only first 2
                if (query[2] !== undefined) query = query.splice(0, 2);
            }
            if (query[1] === '') query[1] = null;
            
            //console.log(window.globalData);
            //console.log(query);
            
            // Split the names into first and last names
            var patrolnames = [];
            for (var i = 0; i < window.globalData.length; i++) {
                var fullname = window.globalData[i]['Scout\'s Full Name (last name first):'];
                var name;
                if (fullname.search(', ') > 0) {
                    name = fullname.split(', ');
                    var temp = name[0];
                    name[0] = name[1];
                    name[1] = temp;
                } else if (fullname.search(' ') > 0) {
                    name = fullname.split(' ');
                } else if (fullname.search(',') > 0) {
                    name = fullname.split(',');
                    temp = name[0];
                    name[0] = name[1];
                    name[1] = temp;
                } else {
                    name = 'ERROR';
                    console.error('Unable to split given full name into first and last name');
                }
                name[0] = name[0].toLowerCase();
                name[1] = name[1].toLowerCase();
                patrolnames.push(name);
            }
            //console.log(patrolnames);
            
            // Search for patrolnames for query
            var results = [];
            // score lower is better
            var score = [];
            for (i = 0; i < patrolnames.length; i++) {
                // Only first/last name
                if (query[1] === null) {
                    if (patrolnames[i][0] === query[0] || patrolnames[i][1] === query[0]) {
                        score.push({id: i, score: 0});
                    } else {
                        var diff = compare(query[0], patrolnames[i][0]) < compare(query[0], patrolnames[i][1]) ?
                                   compare(query[0], patrolnames[i][0]) : compare(query[0], patrolnames[i][1]);
                        if (diff < query[0].length / 2) {
                            score.push({id: i, score: diff + 1});
                        }
                    }
                // If direct match set score to 0
                } else if (patrolnames[i][0] === query[0] && patrolnames[i][1] === query[1]) {
                    score.push({id: i, score: 0});
                    break;
                // First and last name
                } else {
                    diff = compare(query[0], patrolnames[i][0]) + compare(query[1], patrolnames[i][1]);
                    if (diff < (query[0].length + query[1].length) / 2) {
                        score.push({id: i, score: diff + 1});
                    }
                }
            }
            score.sort(function(a, b) {
                return parseFloat(a.score) - parseFloat(b.score);
            });
            
            // Make sure scores list has items
            if (!(score[0] === undefined)) {
                var firstScore = score[0].score;
                for (i = 0; i < score.length; i++) {
                    // If direct match of query
                    if (score[i].score === firstScore) {
                        results.push(score[i].id);
                    } else if (score[i].score !== firstScore) {
                        break;
                    // Otherwise display up to 3 names
                    } else if (i < 3) {
                        results.push(score[i].id);
                    }
                }
            }
            
            //console.log(window.globalData);
            
            
            // Display search results
            $('#detail').hide();
			
      	    $('#results').hide();
          	if (results.length === 0) {
          	    console.log('1');
          	    $('#no-result').html('Your search - <b>' + userquery + '</b> - did not match any names.');
          	    $('#no-result').show();
          	} else {
          	    console.log('2');
                $('#no-result').hide();
                $('#results > tbody').html('');
                for (var i = 0; i < results.length; i++) {
                    var name = window.globalData[results[i]]['Scout\'s Full Name (last name first):'];
                    $('#results > tbody').append(
                        '<tr><td><a onclick="showfullinfo(' + results[i] + ')">' + name
                     + '</a></td><td>'  + window.globalData[results[i]]['Scout\'s Cell Phone'] + '</td></tr>');
                }
                $('#results').show();
          	}
      	    console.log('3');
        });
        
        
        function showfullinfo(id) {
            console.log(id);
            $('#results').hide();
            $('#detail').show().html('').append(
                'Name: '                    + window.globalData[id]['Scout\'s Full Name (last name first):'] + '<br>' +
                'Email: <a href="mailto:'   + window.globalData[id]['Scout\'s E-mail:']                 + '">' + window.globalData[id]['Scout\'s E-mail:'] + '</a><br>' +
                'Cell Phone: <a href="tel:' + window.globalData[id]['Scout\'s Cell Phone']              + '">' + window.globalData[id]['Scout\'s Cell Phone'] + '</a><br>' +
                'Home Phone: <a href="tel:' + window.globalData[id]['Scout\'s Home Phone']              + '">' + window.globalData[id]['Scout\'s Home Phone'] + '</a><br>' +
                'Patrol: '                  + window.globalData[id]['patrol']                           + '<br><br>' +
                'Father\'s Cell Phone: <a href="tel:' + window.globalData[id]['Father\'s Cell Phone']   + '">' + window.globalData[id]['Father\'s Cell Phone'] + '</a><br>' +
                'Father\'s E-mail: <a href="mailto:'  + window.globalData[id]['Father\'s E-mail']       + '">' + window.globalData[id]['Father\'s E-mail'] + '</a><br>' +
                'Mother\'s Cell Phone: <a href="tel:' + window.globalData[id]['Mother\'s Cell Phone']   + '">' + window.globalData[id]['Mother\'s Cell Phone'] + '</a><br>' +
                'Mother\'s E-mail: <a href="mailto:'  + window.globalData[id]['Mother\'s E-mail']       + '">' + window.globalData[id]['Mother\'s E-mail'] + '</a><br>'
            );
        }
    </script>

</body>

</html>
