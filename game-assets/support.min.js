Object.toSource=function(e,t,n){null==t&&(t=0),n||(n="  ");for(var i="",a=0;t>a;a++)i+=n;var s;if(null==e)s="null";else if("function"==typeof e)s=Object.prettyFunctionString(e.toString()).replace(/\n/g,"\n"+i);else if("string"==typeof e)s=e.escape();else if(e instanceof Array){var o=e.map(function(e){return Object.toSource(e)});if(o.join(", ").length<80)s="[ "+o.join(", ")+" ]";else{var o=e.map(function(e){return Object.toSource(e,t+1)});s="[\n"+o.join(",\n")+"\n"+i+"]"}}else if("object"==typeof e){var r=[];for(var a in e){name=-1!=a.search(/^[a-zA-Z0-9]+$/)?i+n+a:Object.toSource(a,t+1);var l=name+" : "+Object.toSource(e[a],t+1).strip();"function"==typeof e[a]&&(l="\n"+l),r.push(l)}s="{\n"+r.join(",\n")+"\n"+i+"}"}else s=e.toString();return i+s},Object.prettyFunctionString=function(e){for(var t=e.replace(/\n\s+/g,"\n"),n="",i=!1,a=!1,s=0;s<t.length;s++){var o=t[s];if('"'==o)i=!i;else if(i&&"\\"==o)s++;else if(!i)if("("==o)a="for"==t.slice(s-4,s-1),n+="  ";else if(")"==o)"\n"==t[s-n.length-1]&&(t=t.splice(s-2,2,""),s-=2),n=n.slice(2);else if("["==o)n+="  ";else if("]"==o)n=n.slice(2);else if("{"==o&&"\\"!=t[s-1])a=!1,n+="  ",t=t.splice(s+1,0,"\n"+n),s+=n.length+1;else if("}"==o&&"\\"!=t[s-1])"\n"==t[s-n.length-1]?(t=t.splice(s-2,2,""),s-=2):" "==t[s-1]?(t=t.splice(s-1,1,""),s-=1):(t=t.splice(s,0,"\n"+n.slice(2)),s+=n.length-1),n=n.slice(2),";"!=t[s+1]&&-1==t.slice(s+1).search(/^\s+else\s+/)&&(t=t.splice(s+1,0,"\n"+n),s+=n.length+1);else if(";"==o){if(!a){var r=t.slice(s+1).search(/\S/);r>0&&(t=t.splice(s+1,r,"")),t=t.splice(s+1,0,"\n"+n),s+=n.length+1}}else if("\n"==o)t=t.splice(s+1,0,n),s+=n.length;else if(","==o&&-1!=t.slice(s).search(/^,\s+\S+:\s/)){var r=t.slice(s+1).search(/\S/);r>0&&(t=t.splice(s+1,r,"")),t=t.splice(s+1,0,"\n"+n),s+=n.length+1}}return t.replace(/\n+(\s+\n+)?/g,"\n")},GuiConfig=Klass({object:null,container:null,controls:null,title:null,description:null,initialize:function(e){if(Object.extend(this,e),this.container||(this.container=document.body),!this.controls)throw"You need to provide a list of controls.";this.element=E("div"),this.element.className="GuiConfig",this.title&&this.element.appendChild(E("h3",this.title,{className:"GuiConfigTitle"})),this.description&&this.element.appendChild(E("div",this.description,{className:"GuiConfigDescription"})),this.createControls()},createControls:function(){for(var e=0;e<this.controls.length;e++){var t=this.controls[e];if("object"==typeof t&&null!=t.length)var n=this.parseType(t[0],t[1],t[2]);else{if("string"!=typeof t)throw"Unsupported control object type: "+t;var i=this.guessObjectType(this.object[t]),n=this.parseType(t,i,null)}var a=GuiConfig.widgets[n.type].apply(GuiConfig.widgets,n.arguments);this.element.appendChild(a)}},guessObjectType:function(e){var t=typeof e;return t},parseType:function(e,t,n){var i={varName:e,methodName:this.parseMethodName(e),object:this,title:this.parseTitle(e)};n&&Object.extend(i,n);var a=t;if("string"==typeof t){if(t.match(/\.\./)){var s=t.split(".."),o=s[0],r=s[1],l=/[-+]?\d+(\.\d+)?/;o.match(l)&&r.match(l)&&(o.match(/\./)||r.match(/\./)?(a="float",i.values=[parseFloat(o),parseFloat(r)]):(a="int",i.values=[parseInt(o),parseInt(r)]))}}else"object"==typeof t&&t.length&&(a="array",i.values=t);return{type:a,arguments:[i]}},parseTitle:function(e){for(var t=e.split(/(?=[A-Z])/),n=1;n<t.length;n++)t[n]=t[n].toLowerCase();return t[0]=t[0].capitalize(),t.join(" ")},parseMethodName:function(e){return"set"+e.capitalize()},show:function(){this.container&&this.container.appendChild(this.element)},hide:function(){this.element.parentNode&&this.element.parentNode.removeChild(this.element)}}),GuiConfig.widgets={__setValue:function(e,t,n,i){e.object&&(e.object[t]?e.object[t](i):e.object[n]=i)},"function":function(e){var t=e.object,n=e.varName,i=e.title,a=E("p"),s=E("input",{type:"submit",value:i});return a.appendChild(s),s.onclick=function(e){return e.preventDefault&&e.preventDefault(),t.object[n](),!1},a},array:function(e){var t=e.object,n=e.methodName,i=e.varName,a=t.object&&t.object[i],s=e.title,o=E("p"),r=E("span",s);r.style.marginBottom="4px";for(var l=E("select"),c=0;c<e.values.length;c++){var u=E("option",{value:e.values[c],content:e.values[c],selected:a==e.values[c]});l.appendChild(u)}return o.appendChild(r),o.appendChild(E("br")),o.appendChild(l),l.onchange=function(){GuiConfig.widgets.__setValue(t,n,i,this.value)},o},"boolean":function(e){var t=e.object,n=e.methodName,i=e.varName,a=e.title,s=E("p"),o=E("input",{type:"checkbox"});return s.appendChild(o),s.appendChild(E("span",a)),o.onchange=function(){GuiConfig.widgets.__setValue(t,n,i,this.checked)},t.object&&(o.checked=t.object[i]),s},"float":function(e){var t=e.values[0],n=e.values[1];return this.slider(function(e){return(1-e)*t+e*n},e)},"int":function(e){var t=e.values[0],n=e.values[1];return this.slider(function(e){return parseInt((1-e)*t+e*n)},e)},slider:function(e,t){var n=t.object,i=t.methodName,a=t.varName,s=t.title,o=E("p"),r=E.canvas(200,10);o.appendChild(r),o.appendChild(E("span",s));var l=new Canvas(r,{redrawOnlyWhenChanged:!0}),c=new CanvasNode,u=new Rectangle(196,2);u.x=2,u.y=4,u.stroke="rgba(0,0,0,0.5)",u.fill="rgba(255,255,255,0.5)";var p=new Rectangle(20,10);p.x=178,p.y=0,p.zIndex=2,p.stroke="rgba(0,0,0,0.5)",p.fill="rgba(255,255,255,0.5)",c.append(u,p);var h,f=1,d=!1;r.addEventListener("mousedown",function(t){var s=Mouse.getRelativeCoords(this,t);h=s.x,d=!0,f=(h-12)/176,f=Math.min(1,Math.max(0,f)),p.x=176*f+2;var o=e(f);GuiConfig.widgets.__setValue(n,i,a,o),l.changed=!0},!1),r.addEventListener("mousemove",function(t){var s=Mouse.getRelativeCoords(this,t);if(d&&null!=h){var o=s.x-h,r=o/176;f=Math.min(1,Math.max(0,f+r)),p.x=176*f+2;var c=e(f);GuiConfig.widgets.__setValue(n,i,a,c),l.changed=!0}h=s.x},!1);var v=function(){d=!1};return window.addEventListener("mouseup",v,!1),r.addEventListener("DOMNodeRemovedFromDocument",function(){window.removeEventListener("mouseup",v,!1)},!1),l.append(c),o}};